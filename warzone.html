<!DOCTYPE html>
<html lang="en" x-data="app()" x-init="init()" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Verdansk Victory Tracker</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { display: ['Orbitron', 'system-ui'], body: ['Inter', 'system-ui'] },
          colors: {
            steel: { 900: '#121416', 800: '#171A1D', 700: '#1F2327', 600: '#2A2F33', 500: '#3A4046' },
            accent: { orange: '#FF6A00', coral: '#F4A896', rose: '#B78CA3', lilac: '#BFA2DB' },
            success: { glow: '#12F29A' },
            danger: { glow: '#FF3B55' }
          },
          boxShadow: {
            glowO: '0 0 0 3px rgba(255,106,0,.35), 0 0 30px rgba(255,106,0,.25)',
            glowG: '0 0 0 2px rgba(18,242,154,.35), 0 0 24px rgba(18,242,154,.2)',
            glowR: '0 0 0 2px rgba(255,59,85,.35), 0 0 24px rgba(255,59,85,.2)',
          }
        }
      }
    }
  </script>

  <!-- Alpine.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

  <style>
    :root{
      --grid-c1: rgba(255,255,255,0.05);
      --grid-c2: rgba(255,106,0,0.06);
    }
    body { background: radial-gradient(1200px 800px at 70% -10%, rgba(255,106,0,0.12), transparent 60%), #121416; color:#fff; }
    /* Subtle animated tech grid */
    .tech-grid::before, .tech-grid::after{
      content:""; position:absolute; inset:0; pointer-events:none; background-size: 48px 48px;
      background-image:
        linear-gradient(to right, var(--grid-c1) 1px, transparent 1px),
        linear-gradient(to bottom, var(--grid-c1) 1px, transparent 1px);
      mask-image: radial-gradient(ellipse at top right, rgba(0,0,0,.8), transparent 65%);
    }
    .tech-grid::after{
      background-image:
        linear-gradient(to right, var(--grid-c2) 1px, transparent 1px),
        linear-gradient(to bottom, var(--grid-c2) 1px, transparent 1px);
      animation: drift 18s linear infinite;
      opacity:.35;
    }
    @keyframes drift { from{transform:translateY(0)} to{transform:translateY(48px)} }
    /* Glass */
    .glass { backdrop-filter: blur(10px); background: linear-gradient(180deg, rgba(58,64,70,.55), rgba(23,26,29,.55)); border: 1px solid rgba(255,255,255,.08); }
    /* Marker pulses */
    .pulse::after{
      content:""; position:absolute; inset:-10px; border-radius:9999px; animation: ping 1.8s cubic-bezier(0,0,.2,1) infinite;
    }
    .pulse.victory::after{ box-shadow: 0 0 0 0 rgba(18,242,154,.35); border: 2px solid rgba(18,242,154,.35); }
    .pulse.defeat::after{ box-shadow: 0 0 0 0 rgba(255,59,85,.35); border: 2px solid rgba(255,59,85,.35); }
    @keyframes ping { 0%{transform:scale(1); opacity:.6} 80%{transform:scale(1.6); opacity:0} 100%{opacity:0} }
    /* Tooltip */
    .tip { transform: translate(-50%, calc(-100% - 14px)); }
    .tip::after{
      content:""; position:absolute; left:50%; transform: translateX(-50%); bottom:-6px; border:6px solid transparent; border-top-color: rgba(0,0,0,.65);
    }
  </style>
</head>

<body class="min-h-full relative tech-grid">
  <!-- Top Bar -->
  <header class="sticky top-0 z-30 border-b border-white/10 bg-steel-900/70 backdrop-blur">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="h-8 w-8 rounded bg-gradient-to-br from-accent-orange/80 to-accent-rose/70 shadow-glowO"></div>
        <h1 class="font-display text-xl tracking-widest">VERDANSK <span class="text-accent-orange">TRACKER</span></h1>
      </div>
      <div class="flex items-center gap-2">
        <button class="px-3 py-1.5 rounded border border-white/10 hover:border-accent-orange/60 transition text-xs tracking-wide"
                @click="showStats = !showStats">STATS</button>
        <button class="px-3 py-1.5 rounded bg-accent-orange/90 hover:bg-accent-orange transition shadow-glowO text-xs tracking-wide"
                @click="$refs.addInfo.showModal()">ADD MARKER</button>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-7xl mx-auto px-4 py-6 grid lg:grid-cols-12 gap-6">
    <!-- Left: Map -->
    <section class="lg:col-span-9 relative rounded-2xl overflow-hidden glass border border-white/10">
      <!-- Map container with zoom/pan -->
      <div class="relative overflow-hidden" x-data="{
          zoom: 1, min: 0.75, max: 3, step: 0.12,
          ox: 0, oy: 0, dragging: false, sx: 0, sy: 0,
          wheel(e){
            e.preventDefault();
            const rect = this.$refs.layer.getBoundingClientRect();
            const mx = e.clientX - rect.left; const my = e.clientY - rect.top;
            const prev = this.zoom;
            const dir = e.deltaY < 0 ? 1 : -1;
            let next = prev * (1 + dir * this.step);
            next = Math.max(this.min, Math.min(this.max, next));
            const scale = next / prev;
            this.ox = mx - scale * (mx - this.ox);
            this.oy = my - scale * (my - this.oy);
            this.zoom = next;
          },
          down(e){ this.dragging = true; this.sx = e.clientX; this.sy = e.clientY; },
          move(e){ if(!this.dragging) return; this.ox += (e.clientX - this.sx); this.oy += (e.clientY - this.sy); this.sx = e.clientX; this.sy = e.clientY; },
          up(){ this.dragging = false; }
        }"
        @wheel="wheel($event)"
        @pointerdown="down($event)" @pointermove="move($event)" @pointerup="up()" @pointerleave="up()"
        :class="dragging ? 'cursor-grabbing' : 'cursor-grab'">
        <div class="relative" x-ref="layer"
             :style="`transform: translate(${ox}px, ${oy}px) scale(${zoom}); transform-origin: 0 0;`"
             @click="$root.preparePin($event)">
          <!-- Map image -->
          <img src="verdansk-map.jpg" alt="Verdansk Map" class="w-full h-[72vh] object-cover select-none pointer-events-none" id="mapImg">
          <!-- Markers -->
          <template x-for="pin in $root.filteredPins" :key="pin.id">
            <div class="absolute" :style="`left:${pin.x}%; top:${pin.y}%;`"
                 @mouseenter="$root.hoverId = pin.id" @mouseleave="$root.hoverId = null">
              <button class="relative -translate-x-1/2 -translate-y-1/2 w-4 h-4 rounded-full border border-white/70"
                      :class="pin.result==='Victory' ? 'bg-success-glow/70 shadow-glowG' : 'bg-danger-glow/70 shadow-glowR'">
                <span class="absolute inset-0 rounded-full pulse" :class="pin.result==='Victory' ? 'victory' : 'defeat'"></span>
              </button>
              <!-- Tooltip -->
              <div x-show="$root.hoverId===pin.id" x-transition class="tip absolute left-1/2 top-0 w-64 p-3 rounded-md bg-black/70 text-sm">
                <div class="flex items-center justify-between mb-1">
                  <span class="font-display tracking-wider" :class="pin.result==='Victory' ? 'text-success-glow' : 'text-danger-glow'">
                    <span x-text="pin.result"></span>
                  </span>
                  <span class="text-white/70" x-text="new Date(pin.when).toLocaleString()"></span>
                </div>
                <div class="text-white/90 font-semibold" x-text="pin.title || 'Untitled'"></div>
                <div class="text-white/70" x-text="pin.notes"></div>
                <div class="mt-2 flex items-center justify-between text-xs text-white/60">
                  <span>Squad: <span class="text-white/80" x-text="pin.squad || '—'"></span></span>
                  <button class="underline hover:text-accent-coral" @click="$root.removePin(pin.id)">remove</button>
                </div>
              </div>
            </div>
          </template>
        </div>
      </div>
      
      <!-- Bottom controls bar -->
      <div class="absolute bottom-3 left-3 right-3 flex flex-wrap items-center gap-2">
        <div class="glass rounded-xl border border-white/10 px-3 py-2 flex items-center gap-3 text-xs">
          <span class="uppercase tracking-widest text-white/70">Filter</span>
          <button class="px-2 py-1 rounded border border-white/10 hover:border-accent-orange/60"
                  :class="filter==='all' && 'bg-white/5'"
                  @click="filter='all'">All</button>
          <button class="px-2 py-1 rounded border border-white/10 hover:border-accent-orange/60"
                  :class="filter==='Victory' && 'bg-white/5 text-success-glow'"
                  @click="filter='Victory'">Victory</button>
          <button class="px-2 py-1 rounded border border-white/10 hover:border-accent-orange/60"
                  :class="filter==='Defeat' && 'bg-white/5 text-danger-glow'"
                  @click="filter='Defeat'">Defeat</button>
        </div>

        <div class="ml-auto glass rounded-xl border border-white/10 px-3 py-2 flex items-center gap-3 text-xs">
          <button class="px-2 py-1 rounded border border-white/10 hover:border-accent-orange/60"
                  @click="exportJSON()">Export</button>
          <label class="px-2 py-1 rounded border border-white/10 hover:border-accent-orange/60 cursor-pointer">
            Import <input type="file" accept="application/json" class="hidden" @change="importJSON($event)">
          </label>
          <button class="px-2 py-1 rounded border border-white/10 hover:border-accent-orange/60"
                  @click="clearAll()">Clear</button>
        </div>
      </div>
    </section>

    <!-- Right: Sidebar -->
    <aside class="lg:col-span-3 space-y-6">
      <div class="glass rounded-2xl p-5 border border-white/10">
        <h2 class="font-display tracking-widest text-sm text-white/80 mb-4">OVERVIEW</h2>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-3 rounded-lg bg-steel-800/70 border border-white/10">
            <div class="text-xs text-white/60 tracking-wider">Total</div>
            <div class="text-2xl font-display"><span x-text="pins.length"></span></div>
          </div>
          <div class="p-3 rounded-lg bg-steel-800/70 border border-white/10 shadow-glowG">
            <div class="text-xs text-white/60 tracking-wider">Victories</div>
            <div class="text-2xl font-display text-success-glow"><span x-text="count('Victory')"></span></div>
          </div>
          <div class="p-3 rounded-lg bg-steel-800/70 border border-white/10 shadow-glowR">
            <div class="text-xs text-white/60 tracking-wider">Defeats</div>
            <div class="text-2xl font-display text-danger-glow"><span x-text="count('Defeat')"></span></div>
          </div>
        </div>
      </div>

      <div x-show="showStats" x-transition
           class="glass rounded-2xl p-5 border border-white/10">
        <h3 class="font-display tracking-widest text-sm text-white/80 mb-3">SESSION STATS</h3>
        <ul class="space-y-2 text-sm text-white/80">
          <li>Most recent: <span class="text-white/95" x-text="pins[0] ? new Date(pins[0].when).toLocaleString() : '—'"></span></li>
          <li>First recorded: <span class="text-white/95" x-text="firstWhen()"></span></li>
          <li>Win rate: <span class="text-white/95" x-text="rate() + '%'"></span></li>
        </ul>
      </div>

      <div class="glass rounded-2xl p-5 border border-white/10">
        <h3 class="font-display tracking-widest text-sm text-white/80 mb-3">LEGEND</h3>
        <div class="flex items-center gap-3 text-sm">
          <span class="inline-block w-3 h-3 rounded-full bg-success-glow shadow-glowG"></span> Victory
        </div>
        <div class="flex items-center gap-3 text-sm mt-2">
          <span class="inline-block w-3 h-3 rounded-full bg-danger-glow shadow-glowR"></span> Defeat
        </div>
        <p class="text-xs text-white/60 mt-4">
          Click anywhere on the map to place a marker, then set details.
        </p>
      </div>
    </aside>
  </main>

  <!-- Add/Edit Modal (native dialog for simplicity) -->
  <dialog x-ref="addInfo" class="backdrop:bg-black/70 rounded-2xl max-w-lg w-[95%] p-0 overflow-hidden">
    <div class="glass border border-white/10">
      <div class="px-5 py-4 border-b border-white/10 flex items-center justify-between">
        <h4 class="font-display tracking-widest">NEW MARKER</h4>
        <button class="text-white/60 hover:text-white" @click="$refs.addInfo.close()">✕</button>
      </div>
      <div class="p-5 space-y-3">
        <div class="grid grid-cols-2 gap-3">
          <label class="text-xs uppercase tracking-wider text-white/70">Result
            <select class="mt-1 w-full bg-steel-700 border border-white/10 rounded p-2"
                    x-model="draft.result">
              <option>Victory</option>
              <option>Defeat</option>
            </select>
          </label>
          <label class="text-xs uppercase tracking-wider text-white/70">When
            <input type="datetime-local" class="mt-1 w-full bg-steel-700 border border-white/10 rounded p-2"
                   x-model="draft.when">
          </label>
        </div>
        <label class="text-xs uppercase tracking-wider text-white/70">Title
          <input type="text" placeholder="Stronghold cleared, clutch finish, etc."
                 class="mt-1 w-full bg-steel-700 border border-white/10 rounded p-2"
                 x-model="draft.title">
        </label>
        <label class="text-xs uppercase tracking-wider text-white/70">Squad
          <input type="text" placeholder="Squad / Gamertag"
                 class="mt-1 w-full bg-steel-700 border border-white/10 rounded p-2"
                 x-model="draft.squad">
        </label>
        <label class="text-xs uppercase tracking-wider text-white/70">Notes
          <textarea rows="3" placeholder="What happened here?"
                    class="mt-1 w-full bg-steel-700 border border-white/10 rounded p-2"
                    x-model="draft.notes"></textarea>
        </label>
        <div class="text-xs text-white/60">
          Coordinates: <span x-text="draft.x?.toFixed(2) ?? '—'"></span>% ,
          <span x-text="draft.y?.toFixed(2) ?? '—'"></span>%
        </div>
      </div>
      <div class="px-5 py-4 border-t border-white/10 flex items-center justify-end gap-2">
        <button class="px-3 py-2 rounded border border-white/10 hover:border-accent-orange/60"
                @click="$refs.addInfo.close()">Cancel</button>
        <button class="px-3 py-2 rounded bg-accent-orange hover:bg-accent-orange/90 shadow-glowO"
                @click="savePin(draft)">Save marker</button>
      </div>
    </div>
  </dialog>

  <!-- Reference Images and Tables -->
  <section class="max-w-7xl mx-auto px-4 py-10 space-y-10">
    <!-- Bunkers -->
    <div class="glass rounded-2xl border border-white/10 overflow-hidden">
      <div class="px-5 py-4 border-b border-white/10">
        <h3 class="font-display tracking-widest text-sm text-white/80">BUNKER LOCATIONS</h3>
      </div>
      <div class="grid md:grid-cols-2">
        <img src="warzone-bunker-locs-1024x1024.jpg" alt="Warzone Bunker Locations" class="w-full h-full object-cover">
        <div class="p-5 overflow-x-auto">
          <table class="min-w-full text-sm">
            <thead class="text-white/70">
              <tr class="text-left">
                <th class="py-2 pr-4 font-semibold">Bunker</th>
                <th class="py-2 pr-4 font-semibold">How to enter</th>
                <th class="py-2 pr-4 font-semibold">Location</th>
              </tr>
            </thead>
            <tbody class="text-white/90 divide-y divide-white/10">
              <tr><td class="py-2 pr-4">Bunker 0</td><td class="py-2 pr-4">Code: 010 110 00</td><td class="py-2 pr-4">South of Hills</td></tr>
              <tr><td class="py-2 pr-4">Bunker 1</td><td class="py-2 pr-4">Code: 042 220 21</td><td class="py-2 pr-4">East of Boneyard</td></tr>
              <tr><td class="py-2 pr-4">Bunker 2</td><td class="py-2 pr-4">Blue Keycard</td><td class="py-2 pr-4">Northeast of Boneyard</td></tr>
              <tr><td class="py-2 pr-4">Bunker 3</td><td class="py-2 pr-4">Code: 301 988 05</td><td class="py-2 pr-4">West of Storage Town</td></tr>
              <tr><td class="py-2 pr-4">Bunker 4</td><td class="py-2 pr-4">Red Keycard</td><td class="py-2 pr-4">Dam</td></tr>
              <tr><td class="py-2 pr-4">Bunker 5</td><td class="py-2 pr-4">Red Keycard</td><td class="py-2 pr-4">South of Military Base</td></tr>
              <tr><td class="py-2 pr-4">Bunker 6</td><td class="py-2 pr-4">Red Keycard</td><td class="py-2 pr-4">East of Quarry</td></tr>
              <tr><td class="py-2 pr-4">Bunker 7</td><td class="py-2 pr-4">Blue Keycard</td><td class="py-2 pr-4">North-west of Stadium</td></tr>
              <tr><td class="py-2 pr-4">Bunker 8</td><td class="py-2 pr-4">Blue Keycard</td><td class="py-2 pr-4">Northwest of Stadium</td></tr>
              <tr><td class="py-2 pr-4">Bunker 9</td><td class="py-2 pr-4">Red Keycard</td><td class="py-2 pr-4">Prison</td></tr>
              <tr><td class="py-2 pr-4">Bunker 10</td><td class="py-2 pr-4">Code: 315 472 06</td><td class="py-2 pr-4">Park</td></tr>
              <tr><td class="py-2 pr-4">Bunker 11</td><td class="py-2 pr-4">Easter egg</td><td class="py-2 pr-4">North of Military Base</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Shacks -->
    <div class="glass rounded-2xl border border-white/10 overflow-hidden">
      <div class="px-5 py-4 border-b border-white/10">
        <h3 class="font-display tracking-widest text-sm text-white/80">SHACK LOCATIONS</h3>
      </div>
      <div class="grid md:grid-cols-2">
        <img src="warzone-shack-locs-1024x1024.jpg" alt="Warzone Shack Locations" class="w-full h-full object-cover">
        <div class="p-5 overflow-x-auto">
          <table class="min-w-full text-sm">
            <thead class="text-white/70">
              <tr class="text-left">
                <th class="py-2 pr-4 font-semibold">Shack location</th>
                <th class="py-2 pr-4 font-semibold">How to open</th>
              </tr>
            </thead>
            <tbody class="text-white/90 divide-y divide-white/10">
              <tr><td class="py-2 pr-4">East of TV Station</td><td class="py-2 pr-4">Code: 018 594 72</td></tr>
              <tr><td class="py-2 pr-4">Farmland</td><td class="py-2 pr-4">Code: 361 582 94</td></tr>
              <tr><td class="py-2 pr-4">West of Prison</td><td class="py-2 pr-4">Code: 135 849 27</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Resources -->
    <div class="glass rounded-2xl border border-white/10 overflow-hidden">
      <div class="px-5 py-4 border-b border-white/10">
        <h3 class="font-display tracking-widest text-sm text-white/80">RESOURCES</h3>
      </div>
      <div class="p-5 overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead class="text-white/70">
            <tr class="text-left">
              <th class="py-2 pr-4 font-semibold">Name</th>
              <th class="py-2 pr-4 font-semibold">Link</th>
            </tr>
          </thead>
          <tbody class="text-white/90 divide-y divide-white/10">
            <tr>
              <td class="py-2 pr-4">WZ Stats</td>
              <td class="py-2 pr-4">
                <a href="https://wzstats.gg/" target="_blank" rel="noopener" class="text-accent-orange hover:underline">https://wzstats.gg/</a>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Alpine data store -->
  <script>
    document.addEventListener('alpine:init', () => {
      Alpine.store('map', {
        pins: [],
        draft: { result: 'Victory', when: '', title: '', squad: '', notes: '', x: null, y: null },
        filter: 'all',
        showStats: false,
        hoverId: null,

        init(){
          this.load();
          this.$nextTick(() => this.$refs.mapImg.focus());
        },
        preparePin(e){
          if(this.showStats) this.showStats = false;
          const rect = this.$refs.mapImg.getBoundingClientRect();
          const x = ((e.clientX - rect.left) / rect.width) * 100;
          const y = ((e.clientY - rect.top) / rect.height) * 100;
          this.draft = { ...this.draft, x, y };
        },
        count(result){
          return this.pins.filter(pin => pin.result === result).length;
        },
        rate(){
          const total = this.pins.length;
          const wins = this.count('Victory');
          return total === 0 ? 0 : Math.round((wins / total) * 100);
        },
        firstWhen(){
          if(this.pins.length === 0) return '—';
          const first = new Date(Math.min(...this.pins.map(pin => new Date(pin.when))));
          return first.toLocaleString();
        },
        exportJSON(){
          const json = this.pins.map(pin => ({
            result: pin.result,
            when: pin.when,
            title: pin.title,
            squad: pin.squad,
            notes: pin.notes,
            x: pin.x,
            y: pin.y
          }));
          const blob = new Blob([JSON.stringify(json, null, 2)], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = Object.assign(document.createElement('a'), {
            href: url,
            download: 'verdansk-victories.json',
            style: 'display:none'
          });
          document.body.appendChild(a);
          a.click();
          URL.revokeObjectURL(url);
        },
        importJSON(e){
          const file = e.target.files[0];
          if(!file) return;
          const reader = new FileReader();
          reader.onload = (event) => {
            try {
              const json = JSON.parse(event.target.result);
              this.pins = json.map(pin => ({
                id: Date.now() + Math.random(),
                result: pin.result,
                when: pin.when,
                title: pin.title,
                squad: pin.squad,
                notes: pin.notes,
                x: pin.x,
                y: pin.y
              }));
              this.save();
            } catch (error) {
              alert('Invalid JSON file');
            }
          };
          reader.readAsText(file);
        },
        clearAll(){
          if(confirm('Are you sure you want to clear all markers?')){
            this.pins = [];
            this.save();
          }
        },
        save(){
          localStorage.setItem('verdansk-victories', JSON.stringify(this.pins));
        },
        load(){
          const json = localStorage.getItem('verdansk-victories');
          if(json) this.pins = JSON.parse(json);
        }
      });

      Alpine.data('app', () => ({
        init() {
          this.$store.map.init();
        }
      }));
    });
  </script>
</body>
</html>
